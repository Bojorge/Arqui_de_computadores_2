`timescale 1ps/1ps
module Fetch_Stage_tb;
    
   logic clk = 0;
	logic reset = 0;
	logic select_next_PC;
	logic [15:0] pc_address;
   logic [15:0] jumpAddress;
	logic [15:0] pc_incremented;
	logic [15:0] offset;
   logic [15:0] mux_output;
	logic [15:0] instruction_fetched;
	 

    // Instanciar el módulo PC_register
    PC_register pc_reg (
        .clk(clk),
        .reset(reset),
        .address_in(mux_output),
        .address_out(pc_address)
    );

    // Instanciar el módulo PC_adder
    PC_adder pc_add (
        .address(pc_address),
        .offset(offset),
        .PC(pc_incremented)
    );

    // Instanciar el módulo mux_2inputs
    mux_2inputs mux_2inputs_PC (
        .data0(pc_incremented),
        .data1(jumpAddress),
        .select(select_next_PC),
        .out(mux_output)
    );

    // Instanciar el módulo ROM
    ROM rom_memory (
        .address(pc_address[7:0]), // Usando solo los 8 bits menos significativos porque la memoria es de 256 celdas
        .clock(clk),
        .q(ROM_data)
    );

		
		
    FetchDecode_register FetchDecode_register_instance (
        .clk(clk),
        .instruction_in(pc_address),
        .instruction_out(instruction_fetched)
    );
	 
	 	 
    
    always #10 clk = ~clk;
    initial begin
        // Ciclo 1:
		  $display("\n --------------------------------------------------------------------");
        $display("***  1 Primer ciclo  *** \n");
		  $display("Direccion que sale del registro PC = %b", pc_address);
		  $display("Dato que sale del sumador del PC = %b", pc_incremented);
		  $display("Dato que sale del mux = %b", mux_output);
		  $display("Instrucción que entra al registro FETCH-DECODE = %b", pc_address);
		  $display("Instrucción que sale al registro FETCH-DECODE = %b", instruction_fetched);
		  
        // Esperar al próximo flanco de subida del reloj
        #20;
		  
		  // Ciclo 2:
		  $display("\n --------------------------------------------------------------------");
        $display("***  2 Segundo ciclo  *** \n");
		  $display("Direccion que sale del registro PC = %b", pc_address);
		  $display("Dato que sale del sumador del PC = %b", pc_incremented);
		  $display("Dato que sale del mux = %b", mux_output);
		  $display("Instrucción que entra al registro FETCH-DECODE = %b", pc_address);
		  $display("Instrucción que sale al registro FETCH-DECODE = %b", instruction_fetched);
		  
        // Esperar al próximo flanco de subida del reloj
        #20;
        
       
        
        // Finalizar la simulación
        $finish;
    end

endmodule
